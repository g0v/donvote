// Generated by LiveScript 1.2.0
var x$;
x$ = angular.module('donvote');
x$.factory('sel2', function(urlpatterns){
  var ret;
  return ret = {
    user: {
      placeholder: '選擇成員',
      minimumInputLength: 2,
      multiple: true,
      ajax: {
        url: urlpatterns.api_user_list(),
        dataType: 'json',
        quietMillis: 100,
        data: function(term, page){
          return {
            username: term,
            page_limit: 5,
            page: page
          };
        },
        results: function(data, page){
          console.log(">>>", data);
          data.results = data.results.map(function(it){
            return {
              id: it.id,
              text: it.owner.username
            };
          });
          return {
            results: data.results,
            more: page * 5 < data.count
          };
        }
      }
    },
    group: {
      placeholder: '選擇群組',
      minimumInputLength: 2,
      multiple: true,
      ajax: {
        url: urlpatterns.api_group_list(),
        dataType: 'json',
        quietMillis: 100,
        data: function(term, page){
          return {
            name: term,
            page_limit: 5,
            page: page
          };
        },
        results: function(data, page){
          data.results = data.results.map(function(it){
            return {
              id: it.id,
              text: it.name
            };
          });
          return {
            results: data.results,
            more: page * 5 < data.count
          };
        }
      }
    }
  };
});
x$.controller('group.edit', ['$scope', '$http', 'resInit', 'urlpatterns', 'sel2'].concat(function($scope, $http, resInit, urlpatterns, sel2){
  console.log(sel2);
  $('#member-chooser').select2(sel2.user);
  $('#staff-chooser').select2(sel2.user);
  $('#member-chooser').on('change', function(){
    return $scope.group.member = $('#member-chooser').val().split(',').map(function(it){
      return {
        id: it
      };
    });
  });
  $('#staff-chooser').on('change', function(){
    return $scope.group.staff = $('#staff-chooser').val().split(',').map(function(it){
      return {
        id: it
      };
    });
  });
  $scope.group = {};
  return $scope.create = function(){
    console.log(">>>", $scope.group);
    return $http({
      url: urlpatterns.api_create_group(),
      method: 'POST',
      data: JSON.stringify($scope.group)
    }).success(function(e){
      return console.log(e);
    }).error(function(e){
      return console.error(e);
    });
  };
}));